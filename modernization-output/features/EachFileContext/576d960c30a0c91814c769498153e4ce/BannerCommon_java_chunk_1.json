{
  "pageContent": "File Path: src/net/jforum/view/forum/common/BannerCommon.java\n\n Original Content: /*\n * Copyright (c) JForum Team\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms,\n * with or without modification, are permitted provided\n * that the following conditions are met:\n *\n * 1) Redistributions of source code must retain the above\n * copyright notice, this list of conditions and the\n * following  disclaimer.\n * 2)  Redistributions in binary form must reproduce the\n * above copyright notice, this list of conditions and\n * the following disclaimer in the documentation and/or\n * other materials provided with the distribution.\n * 3) Neither the name of \"Rafael Steil\" nor\n * the names of its contributors may be used to endorse\n * or promote products derived from this software without\n * specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT\n * HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING,\n * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF\n * MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL\n * THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\n * OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER\n * IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN\n * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF\n * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE\n *\n * Created on Apr 2, 2005 / 9:15:13 AM\n * The JForum Project\n * http://www.jforum.net\n */\npackage net.jforum.view.forum.common;\n\nimport java.util.List;\nimport java.util.Random;\n\nimport net.jforum.dao.BannerDAO;\nimport net.jforum.dao.DataAccessDriver;\nimport net.jforum.entities.Banner;\n\n/**\n * @author Samuel Yung\n * @version $Id: BannerCommon.java,v 1.9 2007/08/01 22:30:05 rafaelsteil Exp $\n */\npublic class BannerCommon\n{\n\tprivate BannerDAO dao;\n\tprivate List banners;\n\n\tpublic BannerCommon()\n\t{\n\t\tthis.dao = DataAccessDriver.getInstance().newBannerDAO();\n\t}\n\n    /**\n     * Check whether the banner will be displayed based on user rights and\n     * banner filter settings.\n     * @return boolean\n     * @param bannerId int\n     */\n    public boolean canBannerDisplay(int bannerId)\n\t{\n    \treturn true;\n\t}\n\n\t/**\n\t * Test whether any active banner exist at the placement indicated.\n\t * @param placement int\n\t * @return boolean\n\t */\n\tpublic boolean isActiveBannerExist(int placement) \n\t{\n\t\tbanners = dao.selectActiveBannerByPlacement(placement);\n\t\tif (banners == null || banners.isEmpty())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\treturn true;\n\t}\n\n\t/**\n\t * Retrieves the correct banner based on weight. Before calling this\n\t * function the isBannerExist(int placement) must be called. The total\n\t * weight for all the same position banners should be equal to 99. If\n\t * the total weight is smaller than 99 and the random number is larger\n\t * than the total weight of all the same position banners, the highest\n\t * weight's banner will be chosen. After a correct banner is found, its\n\t * views variable will be incremented by 1.\n\t *\n\t * @return Banner\n\t */\n\tpublic Banner getBanner()\n\t{\n\t\tBanner result = null;\n\n\t\tif (banners == null || banners.isEmpty())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\t// get correct banner based on weight\n\t\tint r = (new Random().nextInt(99));\n\t\tint weightFrom = 0;\n\t\tint weightTo = 0;\n\t\tfor(int i = 0; i < banners.size(); i++)\n\t\t{\n\t\t\tresult = (Banner)banners.get(i);\n\t\t\tweightTo += result.getWeight();\n\t\t\tif (r >= weightFrom && r < weightTo)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tweightFrom = weightTo;\n\t\t}\n\n        // increment views by 1\n\t\tresult.setViews(result.getViews() + 1);\n\t\tdao.update(result);\n\n\t\treturn result;\n\t}\n}",
  "metadata": {
    "fileId": "BannerCommon_java_chunk_1",
    "fileName": "BannerCommon.java",
    "filePath": "src/net/jforum/view/forum/common/BannerCommon.java"
  }
}