{
  "pageContent": "File Path: src/net/jforum/dao/generic/GenericUserDAO.java\n\n Original Content: /**\n\t * @see net.jforum.dao.UserDAO#incrementPosts(int)\n\t */\n\tpublic void incrementPosts(int userId)\n\t{\n\t\tPreparedStatement p = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.incrementPosts\"));\n\t\t\tp.setInt(1, userId);\n\n\t\t\tp.executeUpdate();\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#incrementRanking(int)\n\t */\n\tpublic void setRanking(int userId, int rankingId)\n\t{\n\t\tPreparedStatement p = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(SystemGlobals.getSql(\"UserModel.rankingId\"));\n\t\t\tp.setInt(1, rankingId);\n\t\t\tp.setInt(2, userId);\n\n\t\t\tp.executeUpdate();\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#setActive(int, boolean)\n\t */\n\tpublic void setActive(int userId, boolean active)\n\t{\n\t\tPreparedStatement p = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(SystemGlobals.getSql(\"UserModel.activeStatus\"));\n\t\t\tp.setInt(1, active ? 1 : 0);\n\t\t\tp.setInt(2, userId);\n\n\t\t\tp.executeUpdate();\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#undelete(int)\n\t */\n\tpublic void undelete(int userId)\n\t{\n\t\tPreparedStatement p = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection()\n\t\t\t\t\t.prepareStatement(SystemGlobals.getSql(\"UserModel.deletedStatus\"));\n\t\t\tp.setInt(1, 0);\n\t\t\tp.setInt(2, userId);\n\n\t\t\tp.executeUpdate();\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#selectAll()\n\t */\n\tpublic List selectAll()\n\t{\n\t\treturn selectAll(0, 0);\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#selectAll(int, int)\n\t */\n\tpublic List selectAll(int startFrom, int count)\n\t{\n\t\tPreparedStatement p = null;\n\t\tResultSet rs = null;\n\n\t\ttry {\n\t\t\tif (count > 0) {\n\t\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\t\tSystemGlobals.getSql(\"UserModel.selectAllByLimit\"));\n\t\t\t\tp.setInt(1, startFrom);\n\t\t\t\tp.setInt(2, count);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tp = JForumExecutionContext.getConnection()\n\t\t\t\t\t\t.prepareStatement(SystemGlobals.getSql(\"UserModel.selectAll\"));\n\t\t\t}\n\n\t\t\trs = p.executeQuery();\n\n\t\t\treturn this.processSelectAll(rs);\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(rs, p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#selectAllWithKarma()\n\t */\n\tpublic List selectAllWithKarma()\n\t{\n\t\treturn this.selectAllWithKarma(0, 0);\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#selectAllWithKarma(int, int)\n\t */\n\tpublic List selectAllWithKarma(int startFrom, int count)\n\t{\n\t\treturn this.loadKarma(this.selectAll(startFrom, count));\n\t}\n\n\tprotected List processSelectAll(ResultSet rs) throws SQLException\n\t{\n\t\tList list = new ArrayList();\n\n\t\twhile (rs.next()) {\n\t\t\tUser u = new User();\n\n\t\t\tu.setEmail(rs.getString(\"user_email\"));\n\t\t\tu.setId(rs.getInt(\"user_id\"));\n\t\t\tu.setTotalPosts(rs.getInt(\"user_posts\"));\n\t\t\tu.setRegistrationDate(new Date(rs.getTimestamp(\"user_regdate\").getTime()));\n\t\t\tu.setUsername(rs.getString(\"username\"));\n\t\t\tu.setDeleted(rs.getInt(\"deleted\"));\n\t\t\tKarmaStatus karma = new KarmaStatus();\n\t\t\tkarma.setKarmaPoints(rs.getInt(\"user_karma\"));\n\t\t\tu.setKarma(karma);\n\t\t\tu.setFrom(rs.getString(\"user_from\"));\n\t\t\tu.setWebSite(rs.getString(\"user_website\"));\n\t\t\tu.setViewEmailEnabled(rs.getInt(\"user_viewemail\") == 1);\n\n\t\t\tlist.add(u);\n\t\t}\n\n\t\treturn list;\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#selectAllByGroup(int, int, int)\n\t */\n\tpublic List selectAllByGroup(int groupId, int start, int count)\n\t{\n\t\tPreparedStatement p = null;\n\t\tResultSet rs = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.selectAllByGroup\"));\n\t\t\tp.setInt(1, groupId);\n\t\t\tp.setInt(2, start);\n\t\t\tp.setInt(3, count);\n\n\t\t\trs = p.executeQuery();\n\n\t\t\treturn this.processSelectAll(rs);\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(rs, p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#getLastUserInfo()\n\t */\n\tpublic User getLastUserInfo()\n\t{\n\t\tPreparedStatement p = null;\n\t\tResultSet rs = null;\n\t\ttry {\n\t\t\tUser u = new User();\n\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.lastUserRegistered\"));\n\t\t\trs = p.executeQuery();\n\t\t\trs.next();\n\n\t\t\tu.setUsername(rs.getString(\"username\"));\n\t\t\tu.setId(rs.getInt(\"user_id\"));\n\n\t\t\treturn u;\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(rs, p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#getTotalUsers()\n\t */\n\tpublic int getTotalUsers()\n\t{\n\t\tPreparedStatement preparedStatement = null;\n\t\ttry {\n\t\t\tpreparedStatement = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.totalUsers\"));\n\t\t\treturn this.getTotalUsersCommon(preparedStatement);\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(preparedStatement);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#getTotalUsersByGroup(int)\n\t */\n\tpublic int getTotalUsersByGroup(int groupId)\n\t{\n\t\tPreparedStatement p = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.totalUsersByGroup\"));\n\t\t\tp.setInt(1, groupId);\n\n\t\t\treturn this.getTotalUsersCommon(p);\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(p);\n\t\t}\n\t}\n\n\tprotected int getTotalUsersCommon(PreparedStatement p) throws SQLException\n\t{\n\t\tResultSet rs = p.executeQuery();\n\t\trs.next();\n\n\t\tint total = rs.getInt(1);\n\n\t\trs.close();\n\t\tp.close();\n\n\t\treturn total;\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#isDeleted(int user_id)\n\t */\n\tpublic boolean isDeleted(int userId)\n\t{\n\t\tPreparedStatement p = null;\n\t\tResultSet rs = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(SystemGlobals.getSql(\"UserModel.isDeleted\"));\n\t\t\tp.setInt(1, userId);\n\n\t\t\tint deleted = 0;\n\n\t\t\trs = p.executeQuery();\n\t\t\tif (rs.next()) {\n\t\t\t\tdeleted = rs.getInt(\"deleted\");\n\t\t\t}\n\n\t\t\treturn deleted == 1;\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(rs, p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#isUsernameRegistered(java.lang.String)\n\t */\n\tpublic boolean isUsernameRegistered(String username)\n\t{\n\t\tboolean status = false;\n\n\t\tPreparedStatement p = null;\n\t\tResultSet rs = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.isUsernameRegistered\"));\n\t\t\tp.setString(1, username);\n\n\t\t\trs = p.executeQuery();\n\t\t\tif (rs.next() && rs.getInt(\"registered\") > 0) {\n\t\t\t\tstatus = true;\n\t\t\t}\n\n\t\t\treturn status;\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(rs, p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#validateLogin(java.lang.String, java.lang.String)\n\t */\n\tpublic User validateLogin(String username, String password)\n\t{\n\t\treturn loginAuthenticator.validateLogin(username, password, null);\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#addToGroup(int, int[])\n\t */\n\tpublic void addToGroup(int userId, int[] groupId)\n\t{\n\t\tPreparedStatement p = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(SystemGlobals.getSql(\"UserModel.addToGroup\"));\n\t\t\tp.setInt(1, userId);\n\n\t\t\tfor (int i = 0; i < groupId.length; i++) {\n\t\t\t\tp.setInt(2, groupId[i]);\n\t\t\t\tp.executeUpdate();\n\t\t\t}\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(p);\n\t\t}\n\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#removeFromGroup(int, int[])\n\t */\n\tpublic void removeFromGroup(int userId, int[] groupId)\n\t{\n\t\tPreparedStatement p = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.removeFromGroup\"));\n\t\t\tp.setInt(1, userId);\n\n\t\t\tfor (int i = 0; i < groupId.length; i++) {\n\t\t\t\tp.setInt(2, groupId[i]);\n\t\t\t\tp.executeUpdate();\n\t\t\t}\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#saveNewPassword(java.lang.String, java.lang.String)\n\t */\n\tpublic void saveNewPassword(String password, String email)\n\t{\n\t\tPreparedStatement p = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.saveNewPassword\"));\n\t\t\tp.setString(1, password);\n\t\t\tp.setString(2, email);\n\t\t\tp.executeUpdate();\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#validateLostPasswordHash(java.lang.String, java.lang.String)\n\t */\n\tpublic boolean validateLostPasswordHash(String email, String hash)\n\t{\n\t\tPreparedStatement p = null;\n\t\tResultSet rs = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.validateLostPasswordHash\"));\n\t\t\tp.setString(1, hash);\n\t\t\tp.setString(2, email);\n\n\t\t\tboolean status = false;\n\n\t\t\trs = p.executeQuery();\n\t\t\tif (rs.next() && rs.getInt(\"valid\") > 0) {\n\t\t\t\tstatus = true;\n\n\t\t\t\tthis.writeLostPasswordHash(email, \"\");\n\t\t\t}\n\n\t\t\treturn status;\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(rs, p);\n\t\t}\n\t}",
  "metadata": {
    "fileId": "GenericUserDAO_java_chunk_3",
    "fileName": "GenericUserDAO.java",
    "filePath": "src/net/jforum/dao/generic/GenericUserDAO.java"
  }
}