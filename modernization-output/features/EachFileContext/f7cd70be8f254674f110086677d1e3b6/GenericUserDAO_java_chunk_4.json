{
  "pageContent": "File Path: src/net/jforum/dao/generic/GenericUserDAO.java\n\n Original Content: /**\n\t * @see net.jforum.dao.UserDAO#validateLostPasswordHash(java.lang.String, java.lang.String)\n\t */\n\tpublic boolean validateLostPasswordHash(String email, String hash)\n\t{\n\t\tPreparedStatement p = null;\n\t\tResultSet rs = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.validateLostPasswordHash\"));\n\t\t\tp.setString(1, hash);\n\t\t\tp.setString(2, email);\n\n\t\t\tboolean status = false;\n\n\t\t\trs = p.executeQuery();\n\t\t\tif (rs.next() && rs.getInt(\"valid\") > 0) {\n\t\t\t\tstatus = true;\n\n\t\t\t\tthis.writeLostPasswordHash(email, \"\");\n\t\t\t}\n\n\t\t\treturn status;\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(rs, p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#writeLostPasswordHash(java.lang.String, java.lang.String)\n\t */\n\tpublic void writeLostPasswordHash(String email, String hash)\n\t{\n\t\tPreparedStatement p = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.writeLostPasswordHash\"));\n\t\t\tp.setString(1, hash);\n\t\t\tp.setString(2, email);\n\t\t\tp.executeUpdate();\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#getUsernameByEmail(java.lang.String)\n\t */\n\tpublic String getUsernameByEmail(String email)\n\t{\n\t\tPreparedStatement p = null;\n\t\tResultSet rs = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.getUsernameByEmail\"));\n\t\t\tp.setString(1, email);\n\n\t\t\tString username = \"\";\n\n\t\t\trs = p.executeQuery();\n\t\t\tif (rs.next()) {\n\t\t\t\tusername = rs.getString(\"username\");\n\t\t\t}\n\n\t\t\treturn username;\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(rs, p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#findByName(java.lang.String, boolean)\n\t */\n\tpublic List findByName(String input, boolean exactMatch)\n\t{\n\t\tList namesList = new ArrayList();\n\n\t\tPreparedStatement p = null;\n\t\tResultSet rs = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(SystemGlobals.getSql(\"UserModel.findByName\"));\n\t\t\tp.setString(1, exactMatch ? input : \"%\" + input + \"%\");\n\n\t\t\trs = p.executeQuery();\n\t\t\twhile (rs.next()) {\n\t\t\t\tUser u = new User();\n\n\t\t\t\tu.setId(rs.getInt(\"user_id\"));\n\t\t\t\tu.setUsername(rs.getString(\"username\"));\n\t\t\t\tu.setEmail(rs.getString(\"user_email\"));\n\t\t\t\tu.setDeleted(rs.getInt(\"deleted\"));\n\n\t\t\t\tnamesList.add(u);\n\t\t\t}\n\t\t\treturn namesList;\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(rs, p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#validateActivationKeyHash(int, java.lang.String)\n\t */\n\tpublic boolean validateActivationKeyHash(int userId, String hash)\n\t{\n\t\tPreparedStatement p = null;\n\t\tResultSet rs = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.validateActivationKeyHash\"));\n\t\t\tp.setString(1, hash);\n\t\t\tp.setInt(2, userId);\n\n\t\t\tboolean status = false;\n\n\t\t\trs = p.executeQuery();\n\t\t\tif (rs.next() && rs.getInt(\"valid\") == 1) {\n\t\t\t\tstatus = true;\n\t\t\t}\n\n\t\t\treturn status;\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(rs, p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#writeUserActive(int)\n\t */\n\tpublic void writeUserActive(int userId)\n\t{\n\t\tPreparedStatement p = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.writeUserActive\"));\n\t\t\tp.setInt(1, userId);\n\t\t\tp.executeUpdate();\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#updateUsername(int, String)\n\t */\n\tpublic void updateUsername(int userId, String username)\n\t{\n\t\tPreparedStatement p = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.updateUsername\"));\n\t\t\tp.setString(1, username);\n\t\t\tp.setInt(2, userId);\n\t\t\tp.executeUpdate();\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#hasUsernameChanged(int, java.lang.String)\n\t */\n\tpublic boolean hasUsernameChanged(int userId, String usernameToCheck)\n\t{\n\t\tPreparedStatement p = null;\n\t\tResultSet rs = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(SystemGlobals.getSql(\"UserModel.getUsername\"));\n\t\t\tp.setString(1, usernameToCheck);\n\t\t\tp.setInt(2, userId);\n\n\t\t\tString dbUsername = null;\n\n\t\t\trs = p.executeQuery();\n\t\t\tif (rs.next()) {\n\t\t\t\tdbUsername = rs.getString(\"username\");\n\t\t\t}\n\n\t\t\tboolean status = false;\n\n\t\t\tif (!usernameToCheck.equals(dbUsername)) {\n\t\t\t\tstatus = true;\n\t\t\t}\n\n\t\t\treturn status;\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(rs, p);\n\t\t}\n\t}\n\n\t/**\n\t * Load KarmaStatus from a list of users.\n\t * \n\t * @param users\n\t *            List\n\t * @return List\n\t * @throws SQLException\n\t */\n\tprotected List loadKarma(List users)\n\t{\n\t\tList result = new ArrayList(users.size());\n\n\t\tfor (Iterator iter = users.iterator(); iter.hasNext();) {\n\t\t\tUser user = (User) iter.next();\n\n\t\t\t// Load Karma\n\t\t\tDataAccessDriver.getInstance().newKarmaDAO().getUserTotalKarma(user);\n\t\t\tresult.add(user);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#saveUserAuthHash(int, java.lang.String)\n\t */\n\tpublic void saveUserAuthHash(int userId, String hash)\n\t{\n\t\tPreparedStatement p = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.saveUserAuthHash\"));\n\t\t\tp.setString(1, hash);\n\t\t\tp.setInt(2, userId);\n\t\t\tp.executeUpdate();\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(p);\n\t\t}\n\t}\n\n\t/**\n\t * @see net.jforum.dao.UserDAO#getUserAuthHash(int)\n\t */\n\tpublic String getUserAuthHash(int userId)\n\t{\n\t\tPreparedStatement p = null;\n\t\tResultSet rs = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.getUserAuthHash\"));\n\t\t\tp.setInt(1, userId);\n\n\t\t\trs = p.executeQuery();\n\n\t\t\tString hash = null;\n\t\t\tif (rs.next()) {\n\t\t\t\thash = rs.getString(1);\n\t\t\t}\n\n\t\t\treturn hash;\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(rs, p);\n\t\t}\n\t}\n\t\n\t/**\n\t * @see net.jforum.dao.UserDAO#findByEmail(java.lang.String)\n\t */\n\tpublic User findByEmail(String email)\n\t{\n\t\tPreparedStatement p = null;\n\t\tResultSet rs = null;\n\t\t\n\t\tUser u = null;\n\t\t\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(\n\t\t\t\t\tSystemGlobals.getSql(\"UserModel.findByEmail\"));\n\t\t\tp.setString(1, email);\n\t\t\trs = p.executeQuery();\n\t\t\t\n\t\t\tif (rs.next()) {\n\t\t\t\tu = new User();\n\t\t\t\tfillUserFromResultSet(u, rs);\n\t\t\t}\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(rs, p);\n\t\t}\n\t\t\n\t\treturn u;\n\t}\n}",
  "metadata": {
    "fileId": "GenericUserDAO_java_chunk_4",
    "fileName": "GenericUserDAO.java",
    "filePath": "src/net/jforum/dao/generic/GenericUserDAO.java"
  }
}