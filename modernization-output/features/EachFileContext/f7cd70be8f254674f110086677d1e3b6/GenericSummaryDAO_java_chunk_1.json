{
  "pageContent": "File Path: src/net/jforum/dao/generic/GenericSummaryDAO.java\n\n Original Content: /* Copyright (c) JForum Team\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms,\n * with or without modification, are permitted provided\n * that the following conditions are met:\n * \n * 1) Redistributions of source code must retain the above\n * copyright notice, this list of conditions and the\n * following  disclaimer.\n * 2)  Redistributions in binary form must reproduce the\n * above copyright notice, this list of conditions and\n * the following disclaimer in the documentation and/or\n * other materials provided with the distribution.\n * 3) Neither the name of \"Rafael Steil\" nor\n * the names of its contributors may be used to endorse\n * or promote products derived from this software without\n * specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT\n * HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING,\n * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF\n * MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL\n * THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\n * OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER\n * IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN\n * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF\n * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE\n *\n * The JForum Project\n * http://www.jforum.net\n */\npackage net.jforum.dao.generic;\n\nimport java.sql.PreparedStatement;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport java.sql.Timestamp;\nimport java.text.SimpleDateFormat;\nimport java.util.ArrayList;\nimport java.util.Date;\nimport java.util.List;\n\nimport net.jforum.JForumExecutionContext;\nimport net.jforum.dao.DataAccessDriver;\nimport net.jforum.dao.SummaryDAO;\nimport net.jforum.entities.Post;\nimport net.jforum.exceptions.DatabaseException;\nimport net.jforum.util.DbUtils;\nimport net.jforum.util.preferences.ConfigKeys;\nimport net.jforum.util.preferences.SystemGlobals;\n\n/**\n * @author Franklin Samir (franklin (at) portaljava [dot] com)\n * @version $Id: GenericSummaryDAO.java,v 1.11 2006/08/23 02:13:41 rafaelsteil Exp $\n */\npublic class GenericSummaryDAO extends AutoKeys implements SummaryDAO\n{\n\t/**\n\t * @see net.jforum.dao.SummaryDAO#selectById(Date, Date)\n\t */\n\tpublic List selectLastPosts(Date firstDate, Date lastDate)\n\t{\n\t\tString query = SystemGlobals.getSql(\"SummaryDAO.selectPosts\");\n\t\tPreparedStatement p = null;\n\t\tResultSet rs = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(query);\n\t\t\tp.setTimestamp(1, new Timestamp(firstDate.getTime()));\n\t\t\tp.setTimestamp(2, new Timestamp(lastDate.getTime()));\n\n\t\t\tList posts = new ArrayList();\n\t\t\trs = p.executeQuery();\n\n\t\t\twhile (rs.next()) {\n\t\t\t\tposts.add(this.fillPost(rs));\n\t\t\t}\n\n\t\t\treturn posts;\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(rs, p);\n\t\t}\n\t}\n\n\tprivate Post fillPost(ResultSet rs) throws SQLException\n\t{\n\t\tPost post = new Post();\n\n\t\tpost.setId(rs.getInt(\"post_id\"));\n\t\tpost.setTopicId(rs.getInt(\"topic_id\"));\n\t\tpost.setForumId(rs.getInt(\"forum_id\"));\n\t\tpost.setUserId(rs.getInt(\"user_id\"));\n\t\tTimestamp postTime = rs.getTimestamp(\"post_time\");\n\t\tpost.setTime(postTime);\n\t\tpost.setSubject(rs.getString(\"post_subject\"));\n\t\tpost.setText(rs.getString(\"post_text\"));\n\t\tpost.setPostUsername(rs.getString(\"username\"));\n\n\t\tSimpleDateFormat df = new SimpleDateFormat(SystemGlobals.getValue(ConfigKeys.DATE_TIME_FORMAT));\n\t\tpost.setFormatedTime(df.format(postTime));\n\n\t\tpost.setKarma(DataAccessDriver.getInstance().newKarmaDAO().getPostKarma(post.getId()));\n\n\t\treturn post;\n\t}\n\n\tpublic List listRecipients()\n\t{\n\t\tString query = SystemGlobals.getSql(\"SummaryDAO.selectAllRecipients\");\n\t\tPreparedStatement p = null;\n\t\tResultSet rs = null;\n\t\ttry {\n\t\t\tp = JForumExecutionContext.getConnection().prepareStatement(query);\n\n\t\t\tList recipients = new ArrayList();\n\t\t\trs = p.executeQuery();\n\n\t\t\tString mail = null;\n\t\t\twhile (rs.next()) {\n\t\t\t\tmail = rs.getString(\"user_email\");\n\t\t\t\tif (mail != null && !mail.trim().equals(\"\")) {\n\t\t\t\t\trecipients.add(mail);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn recipients;\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\tthrow new DatabaseException(e);\n\t\t}\n\t\tfinally {\n\t\t\tDbUtils.close(rs, p);\n\t\t}\n\t}\n}",
  "metadata": {
    "fileId": "GenericSummaryDAO_java_chunk_1",
    "fileName": "GenericSummaryDAO.java",
    "filePath": "src/net/jforum/dao/generic/GenericSummaryDAO.java"
  }
}