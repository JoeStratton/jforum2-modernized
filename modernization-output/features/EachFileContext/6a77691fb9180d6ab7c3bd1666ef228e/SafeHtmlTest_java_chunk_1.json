{
  "pageContent": "File Path: tests/core/net/jforum/util/SafeHtmlTest.java\n\n Original Content: package net.jforum.util;\n\nimport junit.framework.TestCase;\nimport net.jforum.TestCaseUtils;\nimport net.jforum.util.preferences.ConfigKeys;\nimport net.jforum.util.preferences.SystemGlobals;\n\n/**\n * @author Rafael Steil\n * @version $Id: SafeHtmlTest.java,v 1.12 2007/09/19 14:08:56 rafaelsteil Exp $\n */\npublic class SafeHtmlTest extends TestCase\n{\n\tprivate static final String WELCOME_TAGS = \"a, b, i, u, img\";\n\tprivate String input;\n\tprivate String expected;\n\t\n\t/** \n\t * @see junit.framework.TestCase#setUp()\n\t */\n\tprotected void setUp() throws Exception\n\t{\n\t\tTestCaseUtils.loadEnvironment();\n\t\t\n\t\tStringBuffer sb = new StringBuffer(512);\n\t\tsb.append(\"<a href='http://somelink'>Some Link</a>\");\n\t\tsb.append(\"bla <b>bla</b> <pre>code code</pre>\");\n\t\tsb.append(\"<script>document.location = 'xxx';</script>\");\n\t\tsb.append(\"<img src='http://imgPath' onLoad='window.close();'>\");\n\t\tsb.append(\"<a href='javascript:alert(bleh)'>xxxx</a>\");\n\t\tsb.append(\"<img src='javascript:alert(bloh)'>\");\n\t\tsb.append(\"<img src=\\\"&#106ava&#115cript&#58aler&#116&#40&#39Oops&#39&#41&#59\\\">\");\n\t\tsb.append(\"\\\"> TTTTT <\");\n\t\tsb.append(\"<img src='http://some.image' onLoad=\\\"javascript:alert('boo')\\\">\");\n\t\tsb.append(\"<b>heeelooo, nurse</b>\");\n\t\tsb.append(\"<b style='some style'>1, 2, 3</b>\");\n\t\tthis.input = sb.toString();\n\t\t\n\t\tsb = new StringBuffer(512);\n\t\tsb.append(\"<a href='http://somelink'>Some Link</a>\");\n\t\tsb.append(\"bla <b>bla</b> &lt;pre&gt;code code&lt;/pre&gt;\");\n\t\tsb.append(\"&lt;script&gt;document.location = 'xxx';&lt;/script&gt;\");\n\t\tsb.append(\"<img src='http://imgPath' >\");\n\t\tsb.append(\"<a >xxxx</a>\");\n\t\tsb.append(\"<img >\");\n\t\tsb.append(\"<img >\");\n\t\tsb.append(\"&quot;&gt; TTTTT &lt;\");\n\t\tsb.append(\"<img src='http://some.image' >\");\n\t\tsb.append(\"<b>heeelooo, nurse</b>\");\n\t\tsb.append(\"<b >1, 2, 3</b>\");\n\t\tthis.expected = sb.toString();\n\t}\n\t\n\tpublic void testJavascriptInsideURLTagExpectItToBeRemoved()\n\t{\n\t\tString input = \"<a class=\\\"snap_shots\\\" rel=\\\"nofollow\\\" target=\\\"_new\\\" onmouseover=\\\"javascript:alert('test2');\\\" href=\\\"before\\\">test</a>\";\n\t\tString expected = \"<a class=\\\"snap_shots\\\" rel=\\\"nofollow\\\" target=\\\"_new\\\"  >test</a>\";\n\t\t\n\t\tString result = new SafeHtml().ensureAllAttributesAreSafe(input);\n\t\t\n\t\tassertEquals(expected, result);\n\t}\n\t\n\tpublic void testJavascriptInsideImageTagExpectItToBeRemoved()\n\t{\n\t\tString input = \"<img border=\\\"0\\\" onmouseover=\\\"javascript:alert('buuuh!!!');\\\"\\\"\\\" src=\\\"javascript:alert('hi from an alert!');\\\"/>\";\n\t\tString expected = \"<img border=\\\"0\\\" \\\"\\\" />\";\n\t\t\n\t\tString result = new SafeHtml().ensureAllAttributesAreSafe(input);\n\t\t\n\t\tassertEquals(expected, result);\n\t}\n\t\n\tpublic void testIframe() \n\t{\n\t\tString input = \"<iframe src='http://www.google.com' onload='javascript:parent.document.body.style.display=\\'none\\'; alert(\\'where is the forum?\\'); ' style='display:none;'></iframe>\";\n\t\tString output = \"&lt;iframe src='http://www.google.com' onload='javascript:parent.document.body.style.display=\\'none\\'; alert(\\'where is the forum?\\'); ' style='display:none;'&gt;&lt;/iframe&gt;\";\n\t\t\n\t\tSystemGlobals.setValue(ConfigKeys.HTML_TAGS_WELCOME, WELCOME_TAGS);\n\t\tassertEquals(output, new SafeHtml().makeSafe(input));\n\t}\n\t\n\tpublic void testMakeSafe() throws Exception\n\t{\n\t\tSystemGlobals.setValue(ConfigKeys.HTML_TAGS_WELCOME, WELCOME_TAGS);\n\t\tassertEquals(this.expected, new SafeHtml().makeSafe(this.input));\n\t}\n}",
  "metadata": {
    "fileId": "SafeHtmlTest_java_chunk_1",
    "fileName": "SafeHtmlTest.java",
    "filePath": "tests/core/net/jforum/util/SafeHtmlTest.java"
  }
}