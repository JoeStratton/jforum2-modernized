{
  "pageContent": "File Path: src/net/jforum/api/integration/mail/pop/POPConnector.java\n\n Original Content: /*\n * Created on 21/08/2006 21:08:19\n */\npackage net.jforum.api.integration.mail.pop;\n\nimport java.util.Properties;\n\nimport javax.mail.Folder;\nimport javax.mail.Message;\nimport javax.mail.Session;\nimport javax.mail.Store;\nimport javax.mail.Flags.Flag;\n\nimport net.jforum.entities.MailIntegration;\nimport net.jforum.exceptions.MailException;\nimport net.jforum.util.preferences.ConfigKeys;\nimport net.jforum.util.preferences.SystemGlobals;\n\n/**\n * Handles the connection to the POP server.\n * \n * @author Rafael Steil\n * @version $Id: POPConnector.java,v 1.4 2006/10/05 02:00:23 rafaelsteil Exp $\n */\npublic class POPConnector\n{\n\tprivate Store store;\n\tprivate Folder folder;\n\tprivate MailIntegration mailIntegration;\n\tprivate Message[] messages;\n\t\n\t/**\n\t * @param mailIntegration the {@link MailIntegration} instance with \n\t * all the information necessary to connect to the pop server\n\t */\n\tpublic void setMailIntegration(MailIntegration mailIntegration)\n\t{\n\t\tthis.mailIntegration = mailIntegration;\n\t}\n\t\n\t/**\n\t * Lists all available messages in the pop server\n\t * @return Array of {@link Message}'s\n\t */\n\tpublic Message[] listMessages()\n\t{\n\t\ttry {\n\t\t\tthis.messages = this.folder.getMessages();\n\t\t\treturn this.messages;\n\t\t}\n\t\tcatch (Exception e) {\n\t\t\tthrow new MailException(e);\n\t\t}\n\t}\n\t\n\t/**\n\t * Opens a connection to the pop server. \n\t * The method will try to retrieve the <i>INBOX</i> folder in \n\t * <i>READ_WRITE</i> mode\n\t */\n\tpublic void openConnection()\n\t{\n\t\ttry {\n\t\t\tSession session = Session.getDefaultInstance(new Properties());\n\t\t\t\n\t\t\tthis.store = session.getStore(this.mailIntegration.isSSL() ? \"pop3s\" : \"pop3\");\n\n\t\t\tthis.store.connect(this.mailIntegration.getPopHost(), \n\t\t\t\t\tthis.mailIntegration.getPopPort(), \n\t\t\t\t\tthis.mailIntegration.getPopUsername(),\n\t\t\t\t\tthis.mailIntegration.getPopPassword());\n\t\t\t\n\t\t\tthis.folder = this.store.getFolder(\"INBOX\");\n\t\t\t\n\t\t\tif (folder == null) {\n\t\t\t\tthrow new Exception(\"No Inbox\");\n\t\t\t}\n\t\t\t\n\t\t\tthis.folder.open(Folder.READ_WRITE);\n\t\t}\n\t\tcatch (Exception e) {\n\t\t\tthrow new MailException(e);\n\t\t}\n\t}\n\t\n\t/**\n\t * Closes the connection to the pop server.\n\t * Before finishing the communication channel, all messages\n\t * are flaged for deletion.\n\t */\n\tpublic void closeConnection()\n\t{\n\t\tboolean deleteMessages = !SystemGlobals.getBoolValue(ConfigKeys.MAIL_POP3_DEBUG_KEEP_MESSAGES);\n\t\tthis.closeConnection(deleteMessages);\n\t}\n\t\n\t/**\n\t * Closes the connection to the pop server.\n\t * @param deleteAll If true, all messages are flaged for deletion\n\t */\n\tpublic void closeConnection(boolean deleteAll)\n\t{\n\t\tif (deleteAll) {\n\t\t\tthis.markAllMessagesAsDeleted();\n\t\t}\n\t\t\n\t\tif (this.folder != null) try { this.folder.close(false); } catch (Exception e) {}\n\t\tif (this.store != null) try { this.store.close(); } catch (Exception e) {}\n\t}\n\t\n\t/**\n\t * Flag all messages for deletion.\n\t */\n\tprivate void markAllMessagesAsDeleted()\n\t{\n\t\ttry {\n\t\t\tif (this.messages != null) {\n\t\t\t\tfor (int i = 0; i < this.messages.length; i++) {\n\t\t\t\t\tthis.messages[i].setFlag(Flag.DELETED, true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcatch (Exception e) {\n\t\t\tthrow new MailException(e);\n\t\t}\n\t}\n}",
  "metadata": {
    "fileId": "POPConnector_java_chunk_1",
    "fileName": "POPConnector.java",
    "filePath": "src/net/jforum/api/integration/mail/pop/POPConnector.java"
  }
}