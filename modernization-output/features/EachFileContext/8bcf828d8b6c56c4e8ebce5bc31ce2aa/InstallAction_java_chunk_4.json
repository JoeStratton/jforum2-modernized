{
  "pageContent": "File Path: src/net/jforum/view/install/InstallAction.java\n\n Original Content: return status;\n\t}\n\t\n\tpublic void checkInformation() \n\t{\n\t\tthis.setTemplateName(TemplateKeys.INSTALL_CHECK_INFO);\n\t\t\n\t\tString language = this.request.getParameter(\"language\");\n\t\tString database = this.request.getParameter(\"database\");\n\t\tString dbHost = this.request.getParameter(\"dbhost\");\n\t\tString dbPort = this.request.getParameter(\"dbport\");\n\t\tString dbUser = this.request.getParameter(\"dbuser\");\n\t\tString dbName = this.request.getParameter(\"dbname\");\n\t\tString dbPassword = this.request.getParameter(\"dbpasswd\");\n\t\tString dbEncoding = this.request.getParameter(\"dbencoding\");\n\t\tString dbEncodingOther = this.request.getParameter(\"dbencoding_other\");\n\t\tString usePool = this.request.getParameter(\"use_pool\");\n\t\tString forumLink = this.request.getParameter(\"forum_link\");\n\t\tString adminPassword = this.request.getParameter(\"admin_pass1\");\n\t\t\n\t\tdbHost = this.notNullDefault(dbHost, \"localhost\");\n\t\tdbEncodingOther = this.notNullDefault(dbEncodingOther, \"utf-8\");\n\t\tdbEncoding = this.notNullDefault(dbEncoding, dbEncodingOther);\n\t\tforumLink = this.notNullDefault(forumLink, \"http://localhost\");\n\t\tdbName = this.notNullDefault(dbName, \"jforum\");\n\t\t\n\t\tif (\"hsqldb\".equals(database)) {\n\t\t\tdbUser = this.notNullDefault(dbUser, \"sa\");\n\t\t}\n\t\t\n\t\tthis.addToSessionAndContext(\"language\", language);\n\t\tthis.addToSessionAndContext(\"database\", database);\n\t\tthis.addToSessionAndContext(\"dbHost\", dbHost);\n\t\tthis.addToSessionAndContext(\"dbPort\", dbPort);\n\t\tthis.addToSessionAndContext(\"dbUser\", dbUser);\n\t\tthis.addToSessionAndContext(\"dbName\", dbName);\n\t\tthis.addToSessionAndContext(\"dbPassword\", dbPassword);\n\t\tthis.addToSessionAndContext(\"dbEncoding\", dbEncoding);\n\t\tthis.addToSessionAndContext(\"usePool\", usePool);\n\t\tthis.addToSessionAndContext(\"forumLink\", forumLink);\n\t\tthis.addToSessionAndContext(\"siteLink\", this.request.getParameter(\"site_link\"));\n\t\tthis.addToSessionAndContext(\"adminPassword\", adminPassword);\n\t\tthis.addToSessionAndContext(\"dbdatasource\", this.request.getParameter(\"dbdatasource\"));\n\t\tthis.addToSessionAndContext(\"db_connection_type\", this.request.getParameter(\"db_connection_type\"));\n\t\t\n\t\tthis.addToSessionAndContext(\"configureDatabase\", null);\n\t\tthis.addToSessionAndContext(\"createTables\", null);\n\t\tthis.addToSessionAndContext(\"importTablesData\", null);\n\t\t\n\t\tthis.context.put(\"canWriteToWebInf\", this.canWriteToWebInf());\t\t\n\t\tthis.context.put(\"moduleAction\", \"install_check_info.htm\");\n\t}\n\t\n\tprivate void addToSessionAndContext(String key, String value)\n\t{\n\t\tthis.request.getSessionContext().setAttribute(key, value);\n\t\tthis.context.put(key, value);\n\t}\n\t\n\tprivate String notNullDefault(String value, String useDefault)\n\t{\n\t\tif (value == null || value.trim().equals(\"\")) {\n\t\t\treturn useDefault;\n\t\t}\n\t\t\n\t\treturn value;\n\t}\n\t\n\tprivate void storeSupportProjectMessage(Connection connection)\n\t{\n\t\tStringBuffer message = new StringBuffer(\"[color=#3AA315][size=18][b]Support JForum - Help the project[/b][/size][/color]\")\n\t\t\t.append(\"<hr>\")\n\t\t\t.append(\"This project is Open Source, and maintained by at least one full time Senior Developer, [i]which costs US$ 3,000.00 / month[/i]. \")\n\t\t\t.append(\"If it helped you, please consider helping this project - especially with some [b][url=http://www.jforum.net/contribute.jsp]donation[/url][/b].\")\n\t\t\t.append('\\n')\n\t\t\t.append('\\n')\n\t\t\t.append(\"[color=#137C9F][size=14][b]Why supporting this project is a good thing[/b][/size][/color]\")\n\t\t\t.append(\"<hr>\")\n\t\t\t.append(\"The JForum Project started four years ago as a completely free and Open Source program, initially entirely developed on my (Rafael Steil) \")\n\t\t\t.append(\"free time. Today, with the help of some very valuable people, I can spend more time on JForum, to improve it and implement new features \")\n\t\t\t.append(\"(lots of things, requested either on the [url=http://www.jforum.net/forums/list.page]forums[/url] or registered in the \")\n\t\t\t.append(\"[url=http://www.jforum.net/jira]bug tracker[/url]).\")\n\t\t\t.append('\\n')\n\t\t\t.append(\"That's why I'm asking you to financially support this work. I love Open Source. I love to use good products without having to pay for it too. \")\n\t\t\t.append(\"But when I see some program that is valuable to my work, that helps me making money, I think it's a good idea to support this project.\")\n\t\t\t.append('\\n')\n\t\t\t.append('\\n')\n\t\t\t.append(\"[b]Some reasons to support open projects[/b]:\")\n\t\t\t.append(\"<ul><li>Because Open Source is cool? Yes\")\n\t\t\t.append(\"<li>To thank for a great tool? Yes\")\n\t\t\t.append(\"<li>To help the project evolve because this will help my work and my earnings? Yes</ul>\")\n\t\t\t.append(\"Also, as the project grows more and more, it would be great to, sometimes, reward some of the great people who help JForum.\")\n\t\t\t.append('\\n')\n\t\t\t.append('\\n')\n\t\t\t.append(\"So, that's what I'm asking you: if JForum helps your work, saves your time (time is money, remember?) and increase your earnings, support \")\n\t\t\t.append(\"this project. The simpler way is to make [url=http://www.jforum.net/contribute.jsp]any donation[/url] via PayPal.\")\n\t\t\t.append('\\n')\n\t\t\t.append('\\n')\n\t\t\t.append(\"JForum has grown a lot every day, since four years ago, which is a great thing, and initially it wasn't my intention to fully work on this tool. \")\n\t\t\t.append(\"Lately, I'm spending a lot of time on it, specially to make JForum 3 a reality, to help users, to improve the program, to research about \")\n\t\t\t.append(\"better solutions. So, your support is very welcome!\")\n\t\t\t.append('\\n')\n\t\t\t.append('\\n')\n\t\t\t.append(\"Thanks!\") \n\t\t\t.append('\\n')\n\t\t\t.append('\\n')\n\t\t\t.append(\":arrow: [size=16][b][url=http://www.jforum.net/contribute.jsp]Click here[/url][/b] to go to the [i][b][url=http://www.jforum.net/contribute.jsp]\")\n\t\t\t.append(\"\\\"Support JForum\\\"[/url][/b][/i] page.[/size]\")\n\t\t\t.append('\\n')\n\t\t\t.append('\\n');\n\t\t\n\t\ttry {\n\t\t\tConfigLoader.createLoginAuthenticator();\n\t\t\tConfigLoader.loadDaoImplementation();\n\t\t\t\n\t\t\tSystemGlobals.loadQueries(SystemGlobals.getValue(ConfigKeys.SQL_QUERIES_GENERIC));\n\t\t\tSystemGlobals.loadQueries(SystemGlobals.getValue(ConfigKeys.SQL_QUERIES_DRIVER));\n\t\t\t\n\t\t\tSystemGlobals.setValue(ConfigKeys.SEARCH_INDEXING_ENABLED, \"false\");\n\t\t\t\n\t\t\tJForumExecutionContext ex = JForumExecutionContext.get();\n\t\t\tex.setConnection(connection);\n\t\t\tJForumExecutionContext.set(ex);\n\t\t\t\n\t\t\tUser user = new User(2);\n\t\t\t\n\t\t\t// Create topic\n\t\t\tTopic topic = new Topic();\n\t\t\ttopic.setPostedBy(user);\n\t\t\ttopic.setTitle(\"Support JForum - Please read\");\n\t\t\ttopic.setTime(new Date());\n\t\t\ttopic.setType(Topic.TYPE_ANNOUNCE);\n\t\t\ttopic.setForumId(1);\n\t\t\t\n\t\t\tTopicDAO topicDao = DataAccessDriver.getInstance().newTopicDAO();\n\t\t\ttopicDao.addNew(topic);\n\t\t\t\n\t\t\t// Create post\n\t\t\tPost post = new Post();\n\t\t\tpost.setSubject(topic.getTitle());\n\t\t\tpost.setTime(topic.getTime());\n\t\t\tpost.setUserId(user.getId());\n\t\t\tpost.setText(message.toString());\n\t\t\tpost.setForumId(topic.getForumId());\n\t\t\tpost.setSmiliesEnabled(true);\n\t\t\tpost.setHtmlEnabled(true);\n\t\t\tpost.setBbCodeEnabled(true);\n\t\t\tpost.setUserIp(\"127.0.0.1\");\n\t\t\tpost.setTopicId(topic.getId());\n\t\t\t\n\t\t\tPostDAO postDao = DataAccessDriver.getInstance().newPostDAO();\n\t\t\tpostDao.addNew(post);\n\t\t\t\n\t\t\t// Update topic\n\t\t\ttopic.setFirstPostId(post.getId());\n\t\t\ttopic.setLastPostId(post.getId());\n\t\t\t\n\t\t\ttopicDao.update(topic);\n\t\t\t\n\t\t\t// Update forum stats\n\t\t\tForumDAO forumDao = DataAccessDriver.getInstance().newForumDAO();\n\t\t\tforumDao.incrementTotalTopics(1, 1);\n\t\t\tforumDao.setLastPost(1, post.getId());\n\t\t}\n\t\tfinally {\n\t\t\tSystemGlobals.setValue(ConfigKeys.SEARCH_INDEXING_ENABLED, \"true\");\n\t\t\t\n\t\t\tJForumExecutionContext ex = JForumExecutionContext.get();\n\t\t\tex.setConnection(null);\n\t\t\tJForumExecutionContext.set(ex);\n\t\t}\n\t}\n\t\n\t/** \n\t * @see net.jforum.Command#list()\n\t */\n\tpublic void list()\n\t{\n\t\tthis.welcome();\n\t}\n\t\n\t/** \n\t * @see net.jforum.Command#process(net.jforum.context.RequestContext, net.jforum.context.ResponseContext, freemarker.template.SimpleHash) \n     * @param request AWebContextRequest     \n     * @param response HttpServletResponse\n     * @param context SimpleHash\n\t */\n\tpublic Template process(RequestContext request,\n\t\t\tResponseContext response,\n\t\t\tSimpleHash context)  \n\t{\n\t\tthis.setTemplateName(\"default/empty.htm\");\n\t\treturn super.process(request, response, context);\n\t}\n}",
  "metadata": {
    "fileId": "InstallAction_java_chunk_4",
    "fileName": "InstallAction.java",
    "filePath": "src/net/jforum/view/install/InstallAction.java"
  }
}